
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Efficiently loading BigEarthNet &#8212; BigEarthNet Guide</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">BigEarthNet Guide</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="05_basics.html">
   Remote Sensing Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_data-source.html">
   Data Source
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_labels.html">
   BigEarthNet Labels
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="20_raw-data.html">
   Raw BigEarthNet Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="21_visualizations.html">
   Visualizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="25_patch-distribution.html">
   Geographical Patch distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="99_references.html">
   Further references
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/kai-tub/ben-docs"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/efficiently-loading-ben.md.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flexible-loading-of-different-channels">
     Flexible loading of different channels
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#easily-embedding-of-metadata">
     Easily embedding of metadata
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comments">
       Comments
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#easy-to-install">
     Easy to install
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deep-learning-library-agnostic">
     Deep-Learning Library agnostic
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#competitors">
     Competitors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ffcv">
   FFCV
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Efficiently loading BigEarthNet</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#requirements">
   Requirements
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#flexible-loading-of-different-channels">
     Flexible loading of different channels
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#easily-embedding-of-metadata">
     Easily embedding of metadata
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comments">
       Comments
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#easy-to-install">
     Easy to install
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#deep-learning-library-agnostic">
     Deep-Learning Library agnostic
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#competitors">
     Competitors
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ffcv">
   FFCV
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="efficiently-loading-bigearthnet">
<h1>Efficiently loading BigEarthNet<a class="headerlink" href="#efficiently-loading-bigearthnet" title="Permalink to this headline">#</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>MOVE TO BIGEARTHNET ENCODER!</p>
</div>
<p>One crucial component of reducing the training time is minimizing data access.
There are <em>many</em> different approaches with their pros and cons.
This section assembles a couple of popular approaches, discusses possible shortcomings, and gives <em>one</em> strategy to minimize data loading time.</p>
<!-- Before optimizing code, the first question should always be
- Do we need to optimize the code? -->
<p>The assumption is that the data loading procedure is slow and becomes a bottleneck during training.
Looking at the structure of the data, we can identify three possible issues:</p>
<ol class="arabic simple">
<li><p>Provided patches are slow to be read</p>
<ul class="simple">
<li><p>The data is split across multiple files. Each band is stored separately because of the different spatial resolution</p></li>
<li><p>Each <code class="docutils literal notranslate"><span class="pre">tif</span></code> (<a class="reference external" href="https://en.wikipedia.org/wiki/GeoTIFF">GeoTIFF</a>) file contains unnecessary metadata for the training of deep neural networks</p></li>
</ul>
</li>
<li><p>Images need to be converted before passing through common deep learning pipelines</p>
<ul class="simple">
<li><p>Data is stored as <code class="docutils literal notranslate"><span class="pre">uint16</span></code>; most libraries require <code class="docutils literal notranslate"><span class="pre">float32</span></code> or <code class="docutils literal notranslate"><span class="pre">int</span></code></p></li>
</ul>
</li>
<li><p>Lower resolution bands need to be interpolated if they should be converted to a <em>tensor-like</em> structure</p></li>
</ol>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">#</a></h2>
<p>Many tutorials compare and discuss libraries for converting the data into a different format or storing it in a database to optimize the access but are often not well-suited for our heterogeneous satellite data.</p>
<p>To allow us to work with the multi-spectral satellite data flexibly, we have the following requirements:</p>
<section id="flexible-loading-of-different-channels">
<h3>Flexible loading of different channels<a class="headerlink" href="#flexible-loading-of-different-channels" title="Permalink to this headline">#</a></h3>
<p>Initial experiments are often performed on the RGB-only bands to re-use code from other projects/papers that were originally created for the CV domain.
Some experiments may only load the 10m and 20m bands, as the 60m bands <em>often</em> have negligible impact on the performance.
Dropping these bands allows training with larger batches, reducing training time.</p>
<p>This requirement is orthogonal to point <code class="docutils literal notranslate"><span class="pre">3</span></code> of the possible bottlenecks during data loading.
Even if upsampling the channels to a unified dimensionality significantly improves read performance, the library should handle this scenario for the initial experiments. A pre-converted version can reside next to the more general solution.
There should, however, be no need to use two different libraries for both scenarios.</p>
<p>Due to this requirement, the following libraries are ill-fit for the multi-spectral deep-learning domain:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://xarray.pydata.org/en/stable/getting-started-guide/why-xarray.html">xarray</a></p></li>
</ul>
</section>
<section id="easily-embedding-of-metadata">
<h3>Easily embedding of metadata<a class="headerlink" href="#easily-embedding-of-metadata" title="Permalink to this headline">#</a></h3>
<p>Besides the 19-class nomenclature, some experiments could also be performed on the 43-class nomenclature for comparison with other papers.
Geographic metadata about each patch could be used for <em>remote-sensing</em> specific training strategies.</p>
<ul class="simple">
<li><p>Should also allow to easily extend archive with additional information</p></li>
</ul>
<section id="comments">
<h4>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">#</a></h4>
<p>After spending some more time working with satellite data and deep-learning, I personally think that this isn’t as important as I initially thought.
It is often <em>easier</em> and more flexible to keep the metadata separate.</p>
<p>For example: If we do some smart geographic location-based sampling, the metadata has to be available at the start of the epoch to calculate what images should be sampled.
If the metadata is <em>embedded</em> with the image data in a common structure, the image data would probably have to be loaded even if it isn’t necessary.
Some libraries allow metadata reading without loading the images, but this is generally not true for <em>key-value storages</em>.</p>
</section>
</section>
<section id="easy-to-install">
<h3>Easy to install<a class="headerlink" href="#easy-to-install" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Do not require loading via rasterio</p>
<ul>
<li><p>rasterio is complicated to install/brings many hard dependencies with it</p></li>
</ul>
</li>
<li><p>Do not require any <em>real</em> database connections/databases</p></li>
</ul>
</section>
<section id="deep-learning-library-agnostic">
<h3>Deep-Learning Library agnostic<a class="headerlink" href="#deep-learning-library-agnostic" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>Should work with tensor-flow, pytorch or even more exotic interfaces</p></li>
</ul>
</section>
<section id="competitors">
<h3>Competitors<a class="headerlink" href="#competitors" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://realpython.com/storing-images-in-python/#reading-from-lmdb">LMDB</a></p></li>
<li><p>H5PY</p></li>
<li><p><a class="reference external" href="https://ffcv.io/">FFCV</a></p></li>
</ul>
<!-- TODO: Add my attempt at LMDB encoding and list potential issues -->
</section>
</section>
<section id="ffcv">
<h2>FFCV<a class="headerlink" href="#ffcv" title="Permalink to this headline">#</a></h2>
<p>FFCV is a very recent, bleeding-edge data-loading library.</p>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Kai Norman Clasen<br/>
  
      &copy; Copyright 2022, Kai Norman Clasen.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>